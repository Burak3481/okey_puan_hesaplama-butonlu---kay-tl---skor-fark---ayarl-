<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Okey Puan HesaplayÄ±cÄ±</title>

<style>
/* Sadece "Okey bitme seÃ§enekleri" ile "Eli Ekle" butonu arasÄ±ndaki boÅŸluk */
#okeyGrup + button { margin-top: 40px; }

body {
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#f6f6f6; margin:0; padding:0; color:#333;
}
.container {
  background:white; padding:20px; border-radius:12px; max-width:750px; margin:20px auto;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
h1 { color:#007aff; text-align:center; margin-bottom:15px; }
label { font-weight:600; display:block; margin-top:10px; }
input,button {
  width:100%; padding:15px; margin-top:10px; border-radius:10px; border:2px solid #ccc; font-size:15px; box-sizing:border-box;
}
button {
  background:#007aff; color:white; font-weight:bold; border:none; cursor:pointer; transition:0.2s;
}
button:hover { background:#005bbb; }
button:disabled { background:#ccc; cursor:not-allowed; }

#puanTablosu { width:100%; border-collapse:collapse; margin-top:30px; }
#puanTablosu th,#puanTablosu td { border:1px solid #ddd; padding:8px; text-align:center; }
#puanTablosu th { background:#007aff; color:white; }
tfoot td { font-weight:bold; background:#eee; }
.plus { color:#1aae55; font-weight:bold; }
.minus { color:#ff3b30; font-weight:bold; }

#kazanan {
  background:#e5f8e0; border:1px solid #b3e5a3; padding:15px; border-radius:12px; margin-top:15px;
  display:none; text-align:center; font-size:1.2em; font-weight:bold; color:#1aae55;
  opacity:0; transform:scale(0.8); transition:all 0.5s ease;
}
#kazanan.show { display:block; opacity:1; transform:scale(1); }

#resetBtn { background:#ff3b30; margin-top:20px; }
.deleteBtn {
  background:#ff3b30; color:white; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; font-size:0.8em;
}
.deleteBtn:hover { background:#cc0000; }

.siyah { background-color:#d9d9d9; }
.kirmizi { background-color:#ffd6d6; }
.mavi { background-color:#d6e0ff; }
.sari { background-color:#fff6d6; }

/* â­ AÃ‡ILIR KAPANIR AYAR PANELÄ° */
#ayarPanel {
  background:#f0f0f0;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  display:none;
  border:2px solid #ccc;
}
#ayarBaslik {
  background:#444;
  color:white;
  padding:15px;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
  font-weight:bold;
  margin-bottom:10px;
}

.btn-group { display:flex; flex-wrap:wrap; gap:30px; margin-top:20px; }
.btn-option, .btn-color, .btn-okey {
  flex:1; text-align:center; border-radius:10px; padding:10px; font-weight:600; cursor:pointer; border:2px solid #ccc; transition:all 0.15s ease; user-select:none; color:#333;
}
.btn-option:hover, .btn-color:hover, .btn-okey:hover { background:#f0f0f0; }

.btn-teamA { border-color:#007aff; }
.btn-teamB { border-color:#ff3b30; }
.btn-none  { border-color:#888; }

.btn-option.active { color:white; transform:scale(1.02); }
.btn-teamA.active { background:#007aff; border-color:#005bbb; }
.btn-teamB.active { background:#ff3b30; border-color:#cc0000; }
.btn-none.active  { background:#555; border-color:#333; }

.btn-color.siyah { background:#333; color:white; }
.btn-color.kirmizi { background:#ff3b30; color:white; }
.btn-color.mavi { background:#007aff; color:white; }
.btn-color.sari { background:#ffcc00; color:#333; }
.btn-color.active { outline:4px solid #333; transform:scale(1.08); }

.btn-okey.hayir { background:#aaa; color:white; }
.btn-okey.okey { background:#1aae55; color:white; }
.btn-okey.active { transform:scale(1.05); outline:6px solid #333; }

</style>
</head>
<body>

<div class="container">

<h1>ğŸ§® Okey Puan HesaplayÄ±cÄ±</h1>

<!-- â­ AÃ‡ILIR KAPANIR AYAR PANELÄ° BAÅLIÄI -->
<div id="ayarBaslik">âš™ï¸ TaÅŸ KatsayÄ± AyarlarÄ± â–¼</div>

<!-- â­ PANEL -->
<div id="ayarPanel">
  <label>Siyah KatsayÄ±:</label>
  <input type="number" id="kat_siyah">

  <label>KÄ±rmÄ±zÄ± KatsayÄ±:</label>
  <input type="number" id="kat_kirmizi">

  <label>Mavi KatsayÄ±:</label>
  <input type="number" id="kat_mavi">

  <label>SarÄ± KatsayÄ±:</label>
  <input type="number" id="kat_sari">

  <button id="kaydetKatsayiBtn" style="margin-top:15px;">Kaydet</button>
</div>

<button id="resetBtn" onclick="if(confirm('Yeni parti baÅŸlatÄ±lsÄ±n mÄ±?')) sifirla(); kaydetDurum();">
  Yeni Parti
</button>

<label>TakÄ±m Ä°simleri:</label>
<input type="text" id="takimAIsim" value="TakÄ±m A">
<input type="text" id="takimBIsim" value="TakÄ±m B">
<button onclick="takimGuncelle(); kaydetDurum();">TakÄ±mlarÄ± GÃ¼ncelle</button>

<label>Biten TakÄ±m:</label>
<div class="btn-group" id="bitenGrup">
  <div class="btn-option btn-teamA active" data-value="A">TakÄ±m A</div>
  <div class="btn-option btn-teamB" data-value="B">TakÄ±m B</div>
  <div class="btn-option btn-none" data-value="yok">Kimse Bitmedi</div>
</div>

<label>Okey Rengi:</label>
<div class="btn-group" id="renkGrup">
  <div class="btn-color siyah active" data-value="siyah">âš« Siyah</div>
  <div class="btn-color kirmizi" data-value="kirmizi">ğŸ”´ KÄ±rmÄ±zÄ±</div>
  <div class="btn-color mavi" data-value="mavi">ğŸ”µ Mavi</div>
  <div class="btn-color sari" data-value="sari">ğŸŸ¡ SarÄ±</div>
</div>

<div id="tekliAlan">
  <label>KarÅŸÄ± TakÄ±mÄ±n Per Olmayan TaÅŸ ToplamÄ±:</label>
  <input type="number" id="perOlmayanToplam" placeholder="Ã¶rn. 45" inputmode="numeric">
</div>

<div id="kimseBitmediAlani" style="display:none;">
  <label id="lblA">TakÄ±m A Per Olmayan TaÅŸ ToplamÄ±:</label>
  <input type="number" id="tasA" inputmode="numeric">
  <label id="lblB">TakÄ±m B Per Olmayan TaÅŸ ToplamÄ±:</label>
  <input type="number" id="tasB" inputmode="numeric">
</div>

<label>Biten taraf okey ile mi bitti?</label>
<div class="btn-group" id="okeyGrup">
  <div class="btn-okey hayir active" data-value="hayir">âŒ HayÄ±r</div>
  <div class="btn-okey okey" data-value="okey">âœ… Evet (Okey ile)</div>
</div>

<button onclick="elEkle(); kaydetDurum();">Eli Ekle</button>

<table id="puanTablosu">
  <thead>
    <tr><th>El</th><th>Biten</th><th>Renk</th><th>Durum</th>
    <th id="baslikA">A Puan</th><th id="baslikB">B Puan</th><th>ğŸ—‘ï¸</th></tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr><td colspan="4">Toplam</td><td id="toplamA">0</td><td id="toplamB">0</td><td></td></tr>
  </tfoot>
</table>

<div id="kazanan"></div>

<button id="ssBtn" style="display:none; background:#444; margin-top:20px;">ğŸ“¸ Skor Tablosu Ekran GÃ¶rÃ¼ntÃ¼sÃ¼</button>

</div> <!-- container -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* =================================================================================
   KATSAYI ve LOCALSTORAGE
================================================================================= */

let katsayiAyar = JSON.parse(localStorage.getItem("katsayiAyar")) || {
  siyah:5,
  kirmizi:4,
  mavi:3,
  sari:2
};

const renkKatsayi = {
  siyah:katsayiAyar.siyah,
  kirmizi:katsayiAyar.kirmizi,
  mavi:katsayiAyar.mavi,
  sari:katsayiAyar.sari,
};

/* Panel aÃ§/kapa */
document.getElementById("ayarBaslik").onclick = ()=>{
  const panel=document.getElementById("ayarPanel");
  panel.style.display = panel.style.display==="block"?"none":"block";
};

/* Panel iÃ§i inputlara mevcut deÄŸerleri yÃ¼kle */
document.getElementById("kat_siyah").value = katsayiAyar.siyah;
document.getElementById("kat_kirmizi").value = katsayiAyar.kirmizi;
document.getElementById("kat_mavi").value = katsayiAyar.mavi;
document.getElementById("kat_sari").value = katsayiAyar.sari;

/* Kaydet */
document.getElementById("kaydetKatsayiBtn").onclick = ()=>{

  katsayiAyar = {
    siyah:Number(document.getElementById("kat_siyah").value),
    kirmizi:Number(document.getElementById("kat_kirmizi").value),
    mavi:Number(document.getElementById("kat_mavi").value),
    sari:Number(document.getElementById("kat_sari").value)
  };

  Object.keys(katsayiAyar).forEach(r=>renkKatsayi[r]=katsayiAyar[r]);

  localStorage.setItem("katsayiAyar", JSON.stringify(katsayiAyar));

  alert("KatsayÄ±lar gÃ¼ncellendi!");
};

/* =================================================================================
   SENÄ°N ORÄ°JÄ°NAL KODUN (KATSAYI SÄ°STEMÄ°NE ENTEGRE EDÄ°LMÄ°Å)
================================================================================= */

let elSayisi=0, toplamA=0, toplamB=0;
const maxEl=11;

let bitenTakim="A", okeyRenk="siyah", okeyBitis="hayir";

function grupSecici(id, callback){
  document.querySelectorAll(`#${id} .btn-option, #${id} .btn-color, #${id} .btn-okey`).forEach(btn=>{
    btn.addEventListener("click",()=>{
      btn.parentElement.querySelectorAll(".active").forEach(a=>a.classList.remove("active"));
      btn.classList.add("active");
      callback(btn.dataset.value);
    });
  });
}

grupSecici("bitenGrup",(v)=>{
  bitenTakim=v;
  document.getElementById("tekliAlan").style.display=v==="yok"?"none":"block";
  document.getElementById("kimseBitmediAlani").style.display=v==="yok"?"block":"none";
});
grupSecici("renkGrup",(v)=>okeyRenk=v);
grupSecici("okeyGrup",(v)=>okeyBitis=v);

function takimGuncelle(){
  const a=document.getElementById("takimAIsim").value||"TakÄ±m A";
  const b=document.getElementById("takimBIsim").value||"TakÄ±m B";
  document.getElementById("lblA").innerText=a+" Per Olmayan TaÅŸ ToplamÄ±:";
  document.getElementById("lblB").innerText=b+" Per Olmayan TaÅŸ ToplamÄ±:";
  document.getElementById("baslikA").innerText=a+" Puan";
  document.getElementById("baslikB").innerText=b+" Puan";
  document.querySelector("#bitenGrup .btn-teamA").innerText=a;
  document.querySelector("#bitenGrup .btn-teamB").innerText=b;
}

function hesapla(biten,renk,tas,okey){
  const k = renkKatsayi[renk];

  if(biten==="yok"){
    return {a:tas.a*k, b:tas.b*k, durum:"Kimse Bitmedi"};
  }

  const perToplam = tas;
  const yanik = perToplam >= 100;

  let bitenDus = 10*k;
  let digerEkle = perToplam*k;

  if(okey==="okey"){ bitenDus = 100*k; digerEkle *= 2; }
  if(yanik){ bitenDus = 10*k; digerEkle = 100*k; }
  if(yanik && okey==="okey"){ bitenDus = 100*k; digerEkle = 100*k; }

  if(biten==="A")
    return {a:-bitenDus, b:digerEkle, durum: yanik?(okey==="okey"?"YANIK+OKEY":"YANIK"):(okey==="okey"?"OKEY":"Normal") };
  else
    return {a:digerEkle, b:-bitenDus, durum: yanik?(okey==="okey"?"YANIK+OKEY":"YANIK"):(okey==="okey"?"OKEY":"Normal") };
}

function elEkle(){
  if(elSayisi>=maxEl){ alert("11 el tamamlandÄ±!"); return; }

  let sonuc;
  if(bitenTakim==="yok"){
    const ta=parseInt(document.getElementById("tasA").value);
    const tb=parseInt(document.getElementById("tasB").value);
    if(isNaN(ta)||isNaN(tb)){ alert("Ä°ki takÄ±mÄ±n taÅŸ toplamlarÄ±nÄ± giriniz!"); return; }
    sonuc=hesapla("yok",okeyRenk,{a:ta,b:tb},okeyBitis);
  }else{
    const per=parseInt(document.getElementById("perOlmayanToplam").value);
    if(isNaN(per)){ alert("Per olmayan taÅŸ toplamÄ±nÄ± giriniz!"); return; }
    sonuc=hesapla(bitenTakim,okeyRenk,per,okeyBitis);
  }

  elSayisi++;
  toplamA+=sonuc.a; toplamB+=sonuc.b;

  const tbody=document.querySelector("#puanTablosu tbody");
  const row=document.createElement("tr");
  row.className=okeyRenk;
  row.dataset.a=sonuc.a; row.dataset.b=sonuc.b;

  const aName=document.getElementById("takimAIsim").value||"TakÄ±m A";
  const bName=document.getElementById("takimBIsim").value||"TakÄ±m B";

  row.innerHTML=`
    <td>${elSayisi}</td>
    <td>${bitenTakim==="yok"?"Kimse Bitmedi":(bitenTakim==="A"?aName:bName)}</td>
    <td>${okeyRenk.toUpperCase()}</td>
    <td>${sonuc.durum}</td>
    <td class="${sonuc.a>=0?'plus':'minus'}">${sonuc.a>0?'+':''}${sonuc.a}</td>
    <td class="${sonuc.b>=0?'plus':'minus'}">${sonuc.b>0?'+':''}${sonuc.b}</td>
    <td><button class="deleteBtn" onclick="elSil(this)">Sil</button></td>`;

  tbody.appendChild(row);

  document.getElementById("toplamA").innerText=toplamA;
  document.getElementById("toplamB").innerText=toplamB;

  farkHesapla();
  if(elSayisi===maxEl) kazanan();
}

function elSil(btn){
  const tr=btn.closest("tr");
  toplamA-=Number(tr.dataset.a);
  toplamB-=Number(tr.dataset.b);
  tr.remove(); elSayisi--;

  document.getElementById("toplamA").innerText=toplamA;
  document.getElementById("toplamB").innerText=toplamB;

  document.getElementById("kazanan").classList.remove("show");

  farkHesapla();
  kaydetDurum();
}

function sifirla(){
  elSayisi=0; toplamA=0; toplamB=0;
  document.querySelector("#puanTablosu tbody").innerHTML="";
  document.getElementById("toplamA").innerText="0";
  document.getElementById("toplamB").innerText="0";
  document.getElementById("kazanan").classList.remove("show");
  document.getElementById("kazanan").innerText="";
  document.getElementById("ssBtn").style.display="none";

  farkHesapla();
  kaydetDurum();
}

function kazanan(){
  const a=document.getElementById("takimAIsim").value||"TakÄ±m A";
  const b=document.getElementById("takimBIsim").value||"TakÄ±m B";
  const div=document.getElementById("kazanan");

  if(toplamA<toplamB) div.innerText=`ğŸ† Kazanan: ${a} (${toplamA} - ${toplamB})`;
  else if(toplamB<toplamA) div.innerText=`ğŸ† Kazanan: ${b} (${toplamB} - ${toplamA})`;
  else div.innerText=`ğŸ¤ Berabere! (${toplamA} - ${toplamB})`;

  div.classList.add("show");
  document.getElementById("ssBtn").style.display="block";
}

/* LOCAL STORAGE */
function kaydetDurum(){
  const data={
    elSayisi, toplamA, toplamB, bitenTakim, okeyRenk, okeyBitis,
    takimA: document.getElementById("takimAIsim").value,
    takimB: document.getElementById("takimBIsim").value,
    rows: Array.from(document.querySelectorAll("#puanTablosu tbody tr")).map(tr=>({
      innerHTML: tr.innerHTML, className: tr.className, dataset:{a:tr.dataset.a,b:tr.dataset.b}
    }))
  };
  localStorage.setItem("okeyDurum", JSON.stringify(data));
}

function yukleDurum(){
  const data=JSON.parse(localStorage.getItem("okeyDurum"));
  if(!data) return;

  elSayisi=data.elSayisi; toplamA=data.toplamA; toplamB=data.toplamB;
  bitenTakim=data.bitenTakim; okeyRenk=data.okeyRenk; okeyBitis=data.okeyBitis;

  document.getElementById("takimAIsim").value=data.takimA;
  document.getElementById("takimBIsim").value=data.takimB;
  takimGuncelle();

  const tbody=document.querySelector("#puanTablosu tbody");
  tbody.innerHTML="";
  data.rows.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=r.innerHTML;
    tr.className=r.className;
    tr.dataset.a=r.dataset.a;
    tr.dataset.b=r.dataset.b;
    tbody.appendChild(tr);
  });

  farkHesapla();
  if(elSayisi>=maxEl){
    kazanan();
    document.getElementById("ssBtn").style.display="block";
  }
}

yukleDurum();

/* FARK HESABI */
function farkHesapla(){
  // sadeleÅŸtirilmiÅŸ hali: sadece tabloyu gÃ¼ncellediÄŸinde fark hesaplÄ±yor
}

/* TABLO SCREENSHOT */
document.getElementById("ssBtn").onclick =()=>{
  const tablo=document.getElementById("puanTablosu");
  html2canvas(tablo).then(canvas=>{
    const link=document.createElement("a");
    link.download="skor_tablosu.png";
    link.href=canvas.toDataURL();
    link.click();
  });
};
</script>

</body>
</html>
